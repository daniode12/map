#!/usr/bin/env python3

import os
import glob
import subprocess

# --- CONFIGURACI√ìN ---
CARPETA_PROYECTO = "/home/user/mavlink-bridge-pi"
CARPETA_IMG = os.path.join(CARPETA_PROYECTO, "map/img")
ARCHIVO_JSON = os.path.join(CARPETA_PROYECTO, "map/data.json")
MENSAJE_COMMIT = "Limpieza de im√°genes y JSON"

# 1Ô∏è‚É£ Borrar archivo JSON si existe
if os.path.exists(ARCHIVO_JSON):
    os.remove(ARCHIVO_JSON)
    print(f"‚úÖ Archivo JSON eliminado: {ARCHIVO_JSON}")
else:
    print(f"‚ÑπÔ∏è No se encontr√≥ el JSON: {ARCHIVO_JSON}")

# 2Ô∏è‚É£ Borrar todas las im√°genes de la carpeta img
imagenes = glob.glob(os.path.join(CARPETA_IMG, "*.jpg"))
if imagenes:
    for img in imagenes:
        os.remove(img)
        print(f"‚úÖ Imagen eliminada: {img}")
else:
    print(f"‚ÑπÔ∏è No se encontraron im√°genes en: {CARPETA_IMG}")

# 3Ô∏è‚É£ Git add
try:
    subprocess.run(["git", "-C", CARPETA_PROYECTO, "add", "-A"], check=True)
    print("üîπ Git add completado")
except subprocess.CalledProcessError as e:
    print(f"‚ùå Error en git add: {e}")

# 4Ô∏è‚É£ Git commit
try:
    subprocess.run(["git", "-C", CARPETA_PROYECTO, "commit", "-m", MENSAJE_COMMIT], check=True)
    print(f"üìù Git commit realizado: {MENSAJE_COMMIT}")
except subprocess.CalledProcessError as e:
    print(f"‚ÑπÔ∏è No hay cambios para commitear: {e}")

# 5Ô∏è‚É£ Git push
try:
    subprocess.run(["git", "-C", CARPETA_PROYECTO, "push"], check=True)
    print("üöÄ Git push completado")
except subprocess.CalledProcessError as e:
    print(f"‚ùå Error en git push: {e}")

print("üóëÔ∏è Limpieza y push completados")
